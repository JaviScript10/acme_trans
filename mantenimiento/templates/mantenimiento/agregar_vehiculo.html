{% extends 'mantenimiento/base.html' %}

{% block title %}Agregar Vehículo - ACME Trans{% endblock %}

{% block page_title %}Agregar Nuevo Vehículo{% endblock %}

{% block content %}
<div class="row">
    <!-- Formulario para agregar vehículo -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fas fa-car"></i> Registrar Nuevo Vehículo
                </h5>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="{{ form.placa.id_for_label }}" class="form-label">{{ form.placa.label }}</label>
                            {{ form.placa }}
                            {% if form.placa.errors %}
                                <div class="text-danger small">{{ form.placa.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.marca.id_for_label }}" class="form-label">{{ form.marca.label }}</label>
                            {{ form.marca }}
                            {% if form.marca.errors %}
                                <div class="text-danger small">{{ form.marca.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <label for="{{ form.modelo.id_for_label }}" class="form-label">{{ form.modelo.label }}</label>
                            {{ form.modelo }}
                            {% if form.modelo.errors %}
                                <div class="text-danger small">{{ form.modelo.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="{{ form.año.id_for_label }}" class="form-label">{{ form.año.label }}</label>
                            {{ form.año }}
                            {% if form.año.errors %}
                                <div class="text-danger small">{{ form.año.errors }}</div>
                            {% endif %}
                        </div>
                        <div class="col-md-6">
                            <label for="{{ form.kilometraje.id_for_label }}" class="form-label">{{ form.kilometraje.label }}</label>
                            {{ form.kilometraje }}
                            {% if form.kilometraje.errors %}
                                <div class="text-danger small">{{ form.kilometraje.errors }}</div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a href="{% url 'mantenimiento:lista_vehiculos' %}" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> Cancelar
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Guardar Vehículo
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Panel de vehículos existentes -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-list"></i> Vehículos Registrados</h6>
            </div>
            <div class="card-body">
                <p class="text-muted small">Si el vehículo ya está registrado, selecciónalo:</p>
                
                {% if vehiculos_existentes %}
                    <select class="form-select mb-3" id="vehiculoExistente">
                        <option value="">Seleccionar vehículo existente...</option>
                        {% for vehiculo in vehiculos_existentes %}
                            <option value="{{ vehiculo.id }}">
                                {{ vehiculo.placa }} - {{ vehiculo.marca }} {{ vehiculo.modelo }}
                            </option>
                        {% endfor %}
                    </select>
                    
                    <button type="button" class="btn btn-outline-primary btn-sm w-100" onclick="irAVehiculoSeleccionado()">
                        <i class="fas fa-eye"></i> Ver Detalle del Seleccionado
                    </button>
                {% else %}
                    <p class="text-muted">No hay vehículos registrados aún.</p>
                {% endif %}
            </div>
        </div>

        <!-- Información adicional -->
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="mb-0"><i class="fas fa-info-circle"></i> Información</h6>
            </div>
            <div class="card-body">
                <ul class="small mb-0">
                    <li>Si el vehículo ya existe, será redirigido a su detalle</li>
                    <li>La placa debe ser única en el sistema</li>
                    <li>Todos los campos son obligatorios</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
function irAVehiculoSeleccionado() {
    const select = document.getElementById('vehiculoExistente');
    const vehiculoId = select.value;
    
    if (vehiculoId) {
        window.location.href = `/vehiculos/${vehiculoId}/`;
    } else {
        alert('Por favor selecciona un vehículo de la lista');
    }
}
</script>
{% endblock %}